<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>صفحهٔ محافظت‌شده</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;background:#f8fafc}
    .card{background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 24px rgba(2,6,23,0.08);max-width:460px;width:92%}
    input{width:100%;padding:12px;margin-top:12px;border:1px solid #e6e6e9;border-radius:8px;font-size:16px}
    button{margin-top:12px;padding:10px 14px;border-radius:8px;border:0;background:#0ea5e9;color:white;font-weight:600;cursor:pointer}
    .err{color:#b91c1c;margin-top:8px;display:none}
    .note{color:#374151;margin-top:8px;font-size:13px}
    pre{background:#f1f5f9;padding:8px;border-radius:6px;overflow:auto;font-size:13px}
  </style>
</head>
<body dir="rtl">
  <div class="card">
    <h3>برای پخش ویدیو رمز را وارد کنید</h3>
    <input id="pw" type="password" placeholder="رمز را وارد کنید" autofocus />
    <button id="ok">پخش</button>
    <div id="err" class="err">رمز اشتباه است</div>
    <div class="note">رمز فارسی یا انگلیسی پذیرفته می‌شود.</div>
    <div style="margin-top:12px;font-size:12px;color:#6b7280">
      به‌روزرسانی: رمز **دیگر در متن صفحه نشان داده نمی‌شود**. (برای امنیت کامل نیاز به سرور دارید)
    </div>
  </div>
<script>
(async function(){
  const ok = document.getElementById('ok');
  const pw = document.getElementById('pw');
  const err = document.getElementById('err');
  const video = "https://hajifirouz21.cdn.asset.aparat.com/aparat-video/fe562bb23f9b41266de0f9c11e04f07d67000599-720p.apt/chunk.m3u8?wmsAuthSign=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbiI6ImIyOTRiZTU2ZTA2MDQ2NjZkMzcyODQwNGM0NzY0ODhlIiwiZXhwIjoxNzYzMDQwNzU4LCJpc3MiOiJTYWJhIElkZWEgR1NJRyJ9.fZeZ8dgszsu-AlljatT5wfrZK4hE37WmJkZ-AS4dZRQ";

  // Stored base64-encoded SHA-256 hashes (not plaintext)
  const stored = ["jP7Nk3qTKOy3HTwI5d0xIFjKfXUXHnum4691c+IQzWw=", "fWa+cM34fj2XqAQ/VvWjykliC8lDAzlz6/FLCAORkiM="];

  async function sha256Base64(str){
    const enc = new TextEncoder().encode(str);
    const hash = await crypto.subtle.digest('SHA-256', enc);
    // convert to base64
    const bytes = new Uint8Array(hash);
    let binary = '';
    for (let i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
    return btoa(binary);
  }

  async function go(){
    err.style.display = 'none';
    const v = pw.value.trim();
    if(!v) return;
    try{
      const h = await sha256Base64(v);
      if(stored.includes(h)){
        window.location.href = video;
      } else {
        err.style.display = 'block';
      }
    } catch(e){
      console.error(e);
      err.style.display = 'block';
    }
  }

  ok.addEventListener('click', go);
  pw.addEventListener('keydown', function(e){ if(e.key === 'Enter') go(); });
})();
</script>
</body>
</html>
